--資料庫Table瘦身執行紀錄
DROP SEQUENCE TRW.LESSEN_TABLE_EXEC_SQ;

CREATE SEQUENCE TRW.LESSEN_TABLE_EXEC_SQ
START WITH 1
MAXVALUE 9999999999
MINVALUE 1
INCREMENT BY 1
CYCLE
NOCACHE;

CREATE PUBLIC SYNONYM LESSEN_TABLE_EXEC_SQ FOR TRW.LESSEN_TABLE_EXEC_SQ;

--開發
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQ TO APADMIN; 

--測試
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQ TO  AP_ROLE, SEL_ROLE, OMP_ROLE, SSP_ROLE, TMS_ROLE, TWS_ROLE, PMS_ROLE;

--正式 (僅限TRW或特定帳號)
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQ TO AP_ROLE, SEL_ROLE; 

--INSERT Table VALUE(LESSEN_TABLE_EXEC_SQ.nextval);
--SELECT LESSEN_TABLE_EXEC_SQ.currval FROM DUAL;

drop table TRW.LESSEN_TABLE_EXEC_JOB;

create table TRW.LESSEN_TABLE_EXEC_JOB(
	"JOB_ID" NUMBER(10) NOT NULL ENABLE,
	"STATUS" CHAR(10) NOT NULL ENABLE,
	"EXEC_FUNC" VARCHAR2(30) NOT NULL ENABLE, 
	"FUNC_START_TIME" TIMESTAMP NOT NULL ENABLE,
	"FUNC_END_TIME" TIMESTAMP,
	"PARA_IS_OLD_DATA" CHAR(1) NOT NULL ENABLE, 
	"PARA_LESS_THAN_MONTHS" NUMBER(4), 
	"PARA_SYS_OWNER" VARCHAR2(10),
	"PARA_TABLE" VARCHAR2(50),
	"PARA_OTHERS" VARCHAR2(100),
	"USER_ID" VARCHAR2(30) NOT NULL ENABLE,
	"SESS_ID" NUMBER(10) NOT NULL ENABLE,
	"CLIENT_IP" VARCHAR2(20) NOT NULL ENABLE,
	"CLIENT_NAME" VARCHAR2(150) NOT NULL ENABLE,
	"CLIENT_MACHINE" VARCHAR2(150) NOT NULL ENABLE,
	"SQL_CODE" NUMBER(6),
	"SQL_ERRM" VARCHAR2(4000),
	CONSTRAINT "LESSEN_TABLE_EXEC_JOB_PK" PRIMARY KEY ("JOB_ID")
);

CREATE PUBLIC SYNONYM LESSEN_TABLE_EXEC_JOB FOR TRW.LESSEN_TABLE_EXEC_JOB;

--開發
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_JOB TO APADMIN; 

--測試
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_JOB TO AP_ROLE, OMP_ROLE, SSP_ROLE, TMS_ROLE, TWS_ROLE, PMS_ROLE; 
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_JOB TO SEL_ROLE; 

--正式(編輯權限僅限TRW或特定帳號)
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_JOB TO SEL_ROLE; 

COMMENT ON TABLE "TRW"."LESSEN_TABLE_EXEC_JOB" IS '資料庫Table瘦身JOB紀錄';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."JOB_ID" IS '資料庫Table瘦身JOB_ID';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."STATUS" IS '執行狀態';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."EXEC_FUNC" IS '執行函數名稱';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."FUNC_START_TIME" IS '執行函數開始時間';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."FUNC_END_TIME" IS '執行函數結束時間';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."PARA_IS_OLD_DATA" IS '函數輸入參數(IS_OLD_DATA)';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."PARA_LESS_THAN_MONTHS" IS '函數輸入參數(LESS_THAN_MONTHS)';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."PARA_SYS_OWNER" IS '函數輸入參數(系統別)';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."PARA_TABLE" IS '函數輸入參數(TABLE名稱)';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."PARA_OTHERS" IS '函數輸入參數(其他)';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."USER_ID" IS 'SQL執行帳號';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."SESS_ID" IS 'SQL Session ID';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."CLIENT_IP" IS '執行設備IP';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."CLIENT_NAME" IS '執行設備帳號';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."CLIENT_MACHINE" IS '執行設備電腦名稱';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."SQL_CODE" IS 'SQL錯誤代碼';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_JOB"."SQL_ERRM" IS 'SQL錯誤描述';


drop table TRW.LESSEN_TABLE_EXEC_SQL;

create table TRW.LESSEN_TABLE_EXEC_SQL(
	"JOB_ID" NUMBER(10) NOT NULL ENABLE,
	"STATUS" CHAR(10) NOT NULL ENABLE,
    "LESSEN_TABLE" VARCHAR2(50) NOT NULL ENABLE, 
    "SYS_OWNER" VARCHAR2(10) NOT NULL ENABLE, 
    "ENABLE" CHAR(1) NOT NULL ENABLE,
	"BASELINE_DATE" DATE NOT NULL ENABLE,
	"OLDEST_DATE" DATE NOT NULL ENABLE,
	"DIFFDATES" NUMBER(5) NOT NULL ENABLE,
    "FIND_OLDEST_DATE_SQL_TEXT" VARCHAR2(500) NOT NULL ENABLE, 
	"SQL_TEXT" VARCHAR2(2000) NOT NULL ENABLE,
	"SQL_CODE" NUMBER(6),
	"SQL_ERRM" VARCHAR2(4000),
	CONSTRAINT "LESSEN_TABLE_EXEC_SQL_PK" PRIMARY KEY ("JOB_ID", "LESSEN_TABLE")
);

CREATE PUBLIC SYNONYM LESSEN_TABLE_EXEC_SQL FOR TRW.LESSEN_TABLE_EXEC_SQL;

--開發
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_SQL TO APADMIN; 

--測試
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_SQL TO AP_ROLE, OMP_ROLE, SSP_ROLE, TMS_ROLE, TWS_ROLE, PMS_ROLE; 
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQL TO SEL_ROLE; 

--正式(編輯權限僅限TRW或特定帳號)
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQL TO SEL_ROLE; 

COMMENT ON TABLE "TRW"."LESSEN_TABLE_EXEC_SQL" IS '資料庫Table瘦身SQL執行紀錄';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."JOB_ID" IS '資料庫Table瘦身JOB_ID';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."STATUS" IS '執行狀態';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."LESSEN_TABLE" IS '表格名稱';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."SYS_OWNER" IS '系統別';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."FIND_OLDEST_DATE_SQL_TEXT" IS '找出最舊資料日期SQL語法';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."SQL_TEXT" IS 'Table瘦身SQL語法';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."ENABLE" IS '啟用狀態';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."BASELINE_DATE" IS '基準日';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."OLDEST_DATE" IS '最舊資料日期';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."DIFFDATES" IS '差異天數';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."SQL_CODE" IS 'SQL錯誤代碼';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL"."SQL_ERRM" IS 'SQL錯誤描述';

drop table TRW.LESSEN_TABLE_EXEC_SQL_DETAIL;

create table TRW.LESSEN_TABLE_EXEC_SQL_DETAIL(
	"JOB_ID" NUMBER(10) NOT NULL ENABLE,
	"LESSEN_TABLE" VARCHAR2(50) NOT NULL ENABLE, 
	"ITERATION_NUM" NUMBER NOT NULL ENABLE,
	"START_TIME" TIMESTAMP NOT NULL ENABLE,
	"END_TIME" TIMESTAMP,
	"ELAPSED" INTERVAL DAY(2) TO SECOND(3),
	"AFFECTED_ROWS" NUMBER(11),
	"SQL_PARAS" VARCHAR2(500),
	"SQL_CODE" NUMBER(6),
	"SQL_ERRM" VARCHAR2(4000),
	CONSTRAINT "LESSEN_TABLE_EXEC_SQL_DETAIL_PK" PRIMARY KEY ("JOB_ID", "LESSEN_TABLE", "ITERATION_NUM")
);

CREATE PUBLIC SYNONYM LESSEN_TABLE_EXEC_SQL_DETAIL FOR TRW.LESSEN_TABLE_EXEC_SQL_DETAIL;

--開發
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_SQL_DETAIL TO APADMIN; 

--測試
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE_EXEC_SQL_DETAIL TO AP_ROLE, OMP_ROLE, SSP_ROLE, TMS_ROLE, TWS_ROLE, PMS_ROLE; 
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQL_DETAIL TO SEL_ROLE; 

--正式(編輯權限僅限TRW或特定帳號)
GRANT SELECT ON TRW.LESSEN_TABLE_EXEC_SQL_DETAIL TO SEL_ROLE; 

COMMENT ON TABLE "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL" IS '資料庫Table瘦身SQL執行明細紀錄';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."JOB_ID" IS '資料庫Table瘦身JOB_ID';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."LESSEN_TABLE" IS '表格名稱';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."ITERATION_NUM" IS 'Iteration Num';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."START_TIME" IS '開始時間';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."END_TIME" IS '結束時間';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."ELAPSED" IS '經歷時間';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."AFFECTED_ROWS" IS '影響資料筆數';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."SQL_CODE" IS 'SQL錯誤代碼';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE_EXEC_SQL_DETAIL"."SQL_ERRM" IS 'SQL錯誤描述';

