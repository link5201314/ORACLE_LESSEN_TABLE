--資料庫Table瘦身控制表
drop table TRW.LESSEN_TABLE;

create table TRW.LESSEN_TABLE(
    "PK_LESSEN_TABLE" VARCHAR2(50) NOT NULL ENABLE, 
    "SYS_OWNER" VARCHAR2(10) NOT NULL ENABLE, 
	"ENABLE" CHAR(1) NOT NULL ENABLE,
	"OLDEST_DATE_STRATEGY" NUMBER(1) NOT NULL ENABLE,
	"CUSTOMER_OLDEST_DATE" DATE,
    "FIND_OLDEST_DATE_SQL_TEXT" VARCHAR2(200), 
	"SQL_TEXT" VARCHAR2(2000) NOT NULL ENABLE, 
    CONSTRAINT "LESSEN_TABLE_PK" PRIMARY KEY ("PK_LESSEN_TABLE")
);

COMMENT ON TABLE "TRW"."LESSEN_TABLE" IS '資料庫Table瘦身控制表';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."PK_LESSEN_TABLE" IS '主鍵表格名稱';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."SYS_OWNER" IS '系統別';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."ENABLE" IS '啟用狀態';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."OLDEST_DATE_STRATEGY" IS '找出最舊資料日期策略[0.SQL 1.自訂日 2.預設日]';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."CUSTOMER_OLDEST_DATE" IS '自訂最舊資料日期';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."FIND_OLDEST_DATE_SQL_TEXT" IS '找出最舊資料日期SQL語法';
COMMENT ON COLUMN "TRW"."LESSEN_TABLE"."SQL_TEXT" IS 'Table瘦身SQL語法';


CREATE PUBLIC SYNONYM LESSEN_TABLE FOR TRW.LESSEN_TABLE;
--開發
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE TO APADMIN; 

--測試
GRANT SELECT, INSERT, UPDATE, DELETE ON TRW.LESSEN_TABLE TO AP_ROLE, OMP_ROLE, SSP_ROLE, TMS_ROLE, TWS_ROLE, PMS_ROLE; 
GRANT SELECT ON TRW.LESSEN_TABLE TO SEL_ROLE; 

--正式(編輯權限僅限TRW或特定帳號)
GRANT SELECT ON TRW.LESSEN_TABLE TO SEL_ROLE; 

truncate table TRW.LESSEN_TABLE;

insert into TRW.LESSEN_TABLE 
values('SSP_CHOT_TRAN_TRI_COUP'
, 'SSP'
, 'Y'
, 0
, null
, 'select trunc(min(UPDATE_DATE)) from SSP_CHOT_TRAN_TRI_COUP'
, 'update SSP_CHOT_TRAN_TRI_COUP set is_old_data = :set_is_old_data where is_old_data = :reverse_is_old_data and UPDATE_DATE between :start_date and :end_date');

insert into TRW.LESSEN_TABLE 
values('SSP_CHOT_TRAN_CAP_HIS'
,'SSP'
,'N'
, 0
, null
,'select trunc(CAST(min(LAST_UPDATE_TIME) as DATE)) from SSP_CHOT_TRAN_CAP_HIS'
, 'update SSP_CHOT_TRAN_CAP_HIS set is_old_data = :set_is_old_data where is_old_data = :reverse_is_old_data and LAST_UPDATE_TIME between :start_date and :end_date');

commit;

select * from TRW.LESSEN_TABLE;
